<!doctype html>
<html lang="en">
  <head>
    <!-- … your head tags … -->
    <script src="https://cdn.socket.io/4.5.1/socket.io.min.js"></script>
  </head>
  <body>
    <!-- … your navbar + container … -->
    <div id="posts" class="row row-cols-1 row-cols-md-2 g-4">
      {% for p in posts %}
      <div class="col" id="post-{{p.id}}">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <h5 class="card-title text-primary">{{ p.category }}</h5>
            <h6 class="card-subtitle mb-2 text-muted">[{{ p.kiosk_id }}] &bull; {{ p.timestamp }}</h6>
            <p class="card-text">{{ p.content[:100] }}{% if p.content|length>100 %}…{% endif %}</p>
            <a href="/post/{{ p.id }}" class="btn btn-outline-primary btn-sm">View Details</a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <script>
      const socket = io();  // auto-connects to same host:port

      socket.on('new_post', post => {
        // build the new card’s HTML
        const col = document.createElement('div');
        col.className = 'col';
        col.id = 'post-' + post.id;
        col.innerHTML = `
          <div class="card h-100 shadow-sm">
            <div class="card-body">
              <h5 class="card-title text-primary">${post.category}</h5>
              <h6 class="card-subtitle mb-2 text-muted">
                [${post.kiosk_id}] &bull; ${post.timestamp}
              </h6>
              <p class="card-text">
                ${post.content.length>100 
                   ? post.content.slice(0,100) + '…' 
                   : post.content}
              </p>
              <a href="/post/${post.id}"
                 class="btn btn-outline-primary btn-sm">View Details</a>
            </div>
          </div>`;

        // prepend to the grid
        document.getElementById('posts').prepend(col);
      });
    </script>
  </body>
</html>
